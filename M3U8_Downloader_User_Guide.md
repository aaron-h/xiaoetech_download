# M3U8视频下载器使用指南

## 1. 程序概述

### 1.1 什么是M3U8视频下载器？
M3U8视频下载器是一个用于下载和转换M3U8格式视频的工具。M3U8是一种基于HTTP的流媒体播放列表格式，常用于在线视频平台。

### 1.2 功能特点
- ✅ 支持批量下载多个M3U8链接
- ✅ 提供两种用户界面：Web界面和终端界面
- ✅ 实时显示下载进度和状态
- ✅ 动态日志记录，便于排查问题
- ✅ 支持自定义线程数、超时时间和重试次数
- ✅ 自动使用FFmpeg转换为MP4格式
- ✅ 支持小鹅通、腾讯云等多种M3U8格式

## 2. 准备工作

### 2.1 系统要求
- **操作系统**：macOS、Windows、Linux
- **Python版本**：3.6或更高版本
- **网络环境**：稳定的互联网连接

### 2.2 安装必要软件

#### 2.2.1 安装Python
- **Windows**：访问 [Python官网](https://www.python.org/) 下载安装包，勾选"Add Python to PATH"
- **macOS**：系统自带Python，或使用Homebrew安装：`brew install python3`
- **Linux**：使用包管理器安装，如 `sudo apt install python3`

#### 2.2.2 安装FFmpeg
FFmpeg是用于转换视频格式的工具，必须安装！

- **Windows**：
  1. 访问 [FFmpeg官网](https://ffmpeg.org/download.html) 下载Windows版本
  2. 解压到任意目录（如C:\ffmpeg）
  3. 将该目录添加到系统环境变量PATH中

- **macOS**：
  ```bash
  brew install ffmpeg
  ```

- **Linux**：
  ```bash
  sudo apt install ffmpeg
  ```

#### 2.2.3 验证安装
打开终端（Windows：命令提示符或PowerShell），输入以下命令验证安装：

```bash
python3 --version  # 应显示Python 3.6+
ffmpeg -version    # 应显示FFmpeg版本信息
```

### 2.3 下载程序文件
将以下文件下载到同一目录：
- `m3u8_web_ui.py` - Web界面版本
- `m3u8_terminal_ui.py` - 终端界面版本
- `templates/index.html` - Web界面模板（已包含在m3u8_web_ui.py中）

## 3. Web界面使用教程

Web界面是最适合新手的使用方式，只需在浏览器中操作即可。

### 3.1 启动Web服务器

1. 打开终端（或命令提示符）
2. 导航到程序文件所在目录
   ```bash
   cd /Users/admin/Documents/trae_projects/Demos  # 替换为你的目录
   ```
3. 运行Web服务器：
   ```bash
   python3 m3u8_web_ui.py
   ```
4. 看到以下输出表示服务器已启动：
   ```
   * Running on http://127.0.0.1:5001
   ```

### 3.2 访问Web界面

1. 打开浏览器（推荐Chrome、Firefox、Safari）
2. 在地址栏输入：`http://127.0.0.1:5001`
3. 你将看到M3U8下载器的Web界面

### 3.3 使用Web界面下载视频

#### 步骤1：输入M3U8链接

- 在文本框中输入一个或多个M3U8链接
- 每个链接占一行
- 示例：
  ```
  https://example.com/video1.m3u8
  https://example.com/video2.m3u8
  ```

#### 步骤2：配置下载参数

- **线程数**：同时下载的线程数量，推荐8-16（数字越大，下载越快，但占用更多网络资源）
- **超时时间**：每个请求的最大等待时间（秒），推荐60
- **重试次数**：下载失败时的重试次数，推荐3

#### 步骤3：开始下载

- 点击"开始下载"按钮
- 观察进度条和状态显示
- 查看实时日志输出

#### 步骤4：查看下载结果

- 下载完成后，在"已下载文件"区域查看结果
- 视频文件默认保存到`./video_output`目录

### 3.4 Web界面功能说明

| 功能区域 | 说明 |
|---------|------|
| 下载配置 | 输入M3U8链接和配置参数 |
| 下载状态 | 显示当前下载进度和状态 |
| 日志输出 | 实时显示下载过程中的日志信息 |
| 已下载文件 | 显示已成功下载的视频文件列表 |

## 4. 终端界面使用教程

终端界面适合习惯命令行操作的用户，提供交互式体验。

### 4.1 启动终端界面

1. 打开终端（或命令提示符）
2. 导航到程序文件所在目录
3. 运行终端界面：
   ```bash
   python3 m3u8_terminal_ui.py
   ```
4. 你将看到终端界面

### 4.2 使用终端界面下载视频

#### 步骤1：添加M3U8链接

1. 按数字键`1`，然后按Enter
2. 输入M3U8链接，然后按Enter
3. 重复上述步骤可添加多个链接

#### 步骤2：配置下载参数

- **设置输出目录**：按数字键`2`，输入目录路径
- **设置线程数**：按数字键`3`，输入线程数量

#### 步骤3：开始下载

- 按数字键`4`，然后按Enter
- 程序将开始下载并显示进度
- 等待下载完成

#### 步骤4：查看下载结果

- 下载完成后，视频文件将保存到指定的输出目录
- 按数字键`5`可查看详细日志

### 4.3 终端界面菜单说明

| 菜单选项 | 功能说明 |
|---------|----------|
| 1. 添加M3U8链接 | 输入并添加M3U8链接 |
| 2. 设置输出目录 | 自定义视频保存位置 |
| 3. 设置线程数 | 调整下载线程数量 |
| 4. 开始下载 | 开始下载已添加的链接 |
| 5. 查看日志 | 查看详细下载日志 |
| 6. 退出 | 退出程序 |

## 5. 常见问题和解决方法

### 5.1 问题：无法启动Web服务器

**错误信息**：
```
Address already in use
Port 5000 is in use by another program.
```

**解决方法**：
1. 修改程序中的端口号：
   - 用文本编辑器打开`m3u8_web_ui.py`
   - 找到`PORT = 5000`，改为其他端口，如`PORT = 5001`
   - 保存文件并重新运行程序

### 5.2 问题：下载失败，提示"未找到ffmpeg"

**解决方法**：
1. 确保已正确安装FFmpeg
2. 验证FFmpeg是否在系统PATH中：
   ```bash
   ffmpeg -version
   ```
3. 如果仍有问题，重新安装FFmpeg

### 5.3 问题：下载速度很慢

**解决方法**：
1. 增加线程数（Web界面或终端界面中设置）
2. 检查网络连接是否稳定
3. 尝试减少同时下载的链接数量

### 5.4 问题：视频下载后无法播放

**可能原因**：
1. M3U8链接无效或已过期
2. 网络中断导致下载不完整
3. FFmpeg转换失败

**解决方法**：
1. 检查M3U8链接是否仍可访问
2. 重新下载该视频
3. 查看日志中的错误信息

## 6. 示例使用场景

### 场景1：下载单个M3U8视频

1. 在Web界面文本框中输入：`https://example.com/video.m3u8`
2. 保持默认配置（线程数8，超时60秒，重试3次）
3. 点击"开始下载"
4. 等待下载完成，在"已下载文件"中查看结果

### 场景2：批量下载多个视频

1. 在Web界面文本框中输入多个链接：
   ```
   https://example.com/video1.m3u8
   https://example.com/video2.m3u8
   https://example.com/video3.m3u8
   ```
2. 调整线程数为16（加快批量下载速度）
3. 点击"开始下载"
4. 观察整体进度，等待所有视频下载完成

### 场景3：使用终端界面下载

1. 运行`python3 m3u8_terminal_ui.py`
2. 按`1`，输入M3U8链接
3. 按`3`，设置线程数为12
4. 按`4`，开始下载
5. 等待下载完成，按`6`退出程序

## 7. 输出文件管理

### 7.1 默认输出目录
- Web界面：默认保存到`./video_output`目录
- 终端界面：默认保存到`./video_output`目录

### 7.2 自定义输出目录
- Web界面：目前不支持直接修改，可在下载后手动移动文件
- 终端界面：按数字键`2`设置自定义目录

### 7.3 文件命名规则
- 默认使用M3U8链接中的文件名（如果可提取）
- 否则使用时间戳命名，如：`video_1634567890.mp4`

## 8. 技术参数

| 参数 | 默认值 | 范围 | 说明 |
|------|--------|------|------|
| 线程数 | 8 | 1-32 | 同时下载的线程数量 |
| 超时时间 | 60秒 | 10-300秒 | 每个请求的最大等待时间 |
| 重试次数 | 3 | 1-10 | 下载失败时的重试次数 |
| Web端口 | 5001 | 1024-65535 | Web服务器监听端口 |

## 9. 更新和维护

### 9.1 检查更新
定期查看程序文件，如有更新会在注释中说明：
```python
# 更新时间: 2025-12-05
```

### 9.2 报告问题
如遇到程序错误或功能建议，可查看日志文件或联系开发者。

## 10. 法律声明

- 请遵守相关法律法规，仅下载和使用合法授权的视频内容
- 本工具仅供学习和研究使用，请勿用于非法用途
- 下载过程中产生的流量费用由用户自行承担

---

**祝您使用愉快！** 🎉

如果您有任何问题或建议，欢迎反馈！